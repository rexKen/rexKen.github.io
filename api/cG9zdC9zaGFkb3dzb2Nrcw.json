{"title":"shadowsocks","date":"2019-01-25T09:20:45.000Z","slug":"shadowsocks","tags":["ss翻墙代理"],"updated":"2019-01-25T10:54:00.051Z","content":"<h1 id=\"搭建SS服务器\"><a href=\"#搭建SS服务器\" class=\"headerlink\" title=\"搭建SS服务器\"></a>搭建SS服务器</h1><h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><ol>\n<li>一台国外的服务器，安装了CentOS7的一台国外的服务器，搬瓦工，vultr或者淘宝都能买到。拿到服务器的ip、帐号密码。</li>\n<li>Xshell或者 putty 可通过ssh协议远程登陆到服务器的工具（本文使用的是Xshell6）</li>\n<li>shadowsocks(简称ss)客户端,小飞机，github可以下载，不过到github下载也需要翻墙</li>\n</ol>\n<h2 id=\"开始搭建\"><a href=\"#开始搭建\" class=\"headerlink\" title=\"开始搭建\"></a>开始搭建</h2><p>​    购置服务器获得ip、帐号密码以后。安装我们的Xshell回话管理器。点击新建一个会话</p>\n<div class=\"article-img\"><p><img src=\"/images/shadowsocks/1548396307910.png\" alt=\"1548396307910\"></p></div>\n<p>​    然后将你的服务ip填写进入，端口号是默认的22。重新连接的时间间隔我们习惯8-10秒，填写完毕之后点击连接</p>\n<div class=\"article-img\"><p><img src=\"/images/shadowsocks/1548396741200.png\" alt=\"1548396741200\"></p></div>\n<p>​    这时 会弹出SSH的安全警告，此处点击接受并保存主机密钥即可</p>\n<div class=\"article-img\"><p><img src=\"/images/shadowsocks/1548396792777.png\" alt=\"1548396792777\"></p></div>\n<p>​    创建连接以后会要求你输入linux服务器的帐号密码，将购买服务器时的帐号密码输入。就能连接到你的linux服务器了。</p>\n<div class=\"article-img\"><p><img src=\"/images/shadowsocks/1548396868366.png\" alt=\"1548396868366\"></p></div>\n<div class=\"article-img\"><p><img src=\"/images/shadowsocks/1548396895580.png\" alt=\"1548396895580\"></p></div>\n<p>​    登陆成功以后即可进行搭建我们的SS服务器了（可能有些时候输入密码两次）。我们可以看到回话中的终端，已经成功连接到了服务器。</p>\n<div class=\"article-img\"><p><img src=\"/images/shadowsocks/1548396933809.png\" alt=\"1548396933809\"></p></div>\n<p>​       首先服务器中安装一个shadowsocks服务器。CentOS中可以是用yum命令进行软件的安装。然后我们先安装一个pip管理工具，然后再通过pip包管理工具安装我们需要的shadowsocks。敲一下的命令行执行(#行是注释）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span>安装python setup tools</span><br><span class=\"line\">yum install python-setuptools -y</span><br><span class=\"line\"><span class=\"meta\">#</span>安装pip</span><br><span class=\"line\">easy_install pip</span><br><span class=\"line\"><span class=\"meta\">#</span>升级pip</span><br><span class=\"line\">pip install -U pip</span><br><span class=\"line\"><span class=\"meta\">#</span>pip 安装shadowsocks</span><br><span class=\"line\">pip install shadowsocks</span><br></pre></td></tr></table></figure>\n<p>​    安装完成以后，显示如图</p>\n<div class=\"article-img\"><p><img src=\"/images/shadowsocks/1548397299264.png\" alt=\"1548397299264\"></p></div>\n<p>​    安装成功以后，进行ss服务器的配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span>创建配置文件(此文件是新增文件)</span><br><span class=\"line\">vi /etc/shadowsocks.json</span><br></pre></td></tr></table></figure>\n<p>​    将配置内容复制到配置文件中，配置内容的格式为，第一个为单端口格式，第二个为多端口</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &#123;</span><br><span class=\"line\"> \"server\":\"0.0.0.0\",            --服务器IP，直接用0.0.0.0也可</span><br><span class=\"line\"> \"server_port\":8888,            --端口端口</span><br><span class=\"line\"> \"local_address\": \"127.0.0.1\",  --本地地址，可省略</span><br><span class=\"line\"> \"local_port\":1080,             --本地端口，可省略</span><br><span class=\"line\"> \"password\":\"password\",         --密码</span><br><span class=\"line\"> \"timeout\":300,                 --超时时间，可省略</span><br><span class=\"line\"> \"method\":\"aes-256-cfb\",        --加密策略，有多重策略，具体自查</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"server\"</span>:<span class=\"string\">\"0.0.0.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"local_address\"</span>:<span class=\"string\">\"127.0.0.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"local_port\"</span>:<span class=\"number\">1080</span>,</span><br><span class=\"line\">    \"port_password\":&#123;           --每个端口对应一个密码</span><br><span class=\"line\">        \"1111\":\"password1\",</span><br><span class=\"line\">        \"1112\":\"password2\",</span><br><span class=\"line\">        \"1113\":\"password3\"</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    \"timeout\":300,</span><br><span class=\"line\">    \"method\":\"aes-256-cfb\",</span><br><span class=\"line\">    \"fast_open\":false</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>​    我们暂时只需要用到单端口的配置内容，将配置内容放到配置文件上（Linux服务器vim编辑器中，i指令进入编辑操作，按Esc后:wq保存修改并退出，:q不保存退出）,配置如下</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &#123;</span><br><span class=\"line\"> \"server\":\"139.180.134.227\",            --服务器IP，直接用0.0.0.0也可</span><br><span class=\"line\"> \"server_port\":8989,            --端口端口</span><br><span class=\"line\"> \"local_address\": \"127.0.0.1\",  --本地地址，可省略</span><br><span class=\"line\"> \"local_port\":1080,             --本地端口，可省略</span><br><span class=\"line\"> \"password\":\"password\",         --密码</span><br><span class=\"line\"> \"timeout\":300,                 --超时时间，可省略</span><br><span class=\"line\"> \"method\":\"aes-256-cfb\",        --加密策略，有多重策略，具体自查</span><br><span class=\"line\"> \"fast_open\": false,</span><br><span class=\"line\"> \"workders\": 1</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<div class=\"article-img\"><p><img src=\"/images/shadowsocks/1548401178592.png\" alt=\"1548401178592\"></p></div>\n<p>​    接下来我们配置一下ss在服务器中的启动脚本，通过配置启动脚本更好的管理ss服务。(因为centOS 7以后所有的服务都由systemd管理，所以需要统一配置管理)。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#新建一个启动脚本文件,注册该ss服务</span><br><span class=\"line\">vi /etc/systemd/system/shadowsocks.service</span><br></pre></td></tr></table></figure>\n<p>​    在编辑器中输入以下注册内容</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Shadowsocks</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">TimeoutStartSec=0</span><br><span class=\"line\">ExecStart=/usr/bin/ssserver -c /etc/shadowsocks.json</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n<p>​    复制粘贴完毕以后按Esc键，输入:wq保存退出</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span>系统授权允许ss服务</span><br><span class=\"line\">systemctl enable shadowsocks</span><br><span class=\"line\"><span class=\"meta\">#</span>系统启动ss服务</span><br><span class=\"line\">systemctl start shadowsocks</span><br></pre></td></tr></table></figure>\n<p>​    执行完以上步骤以后我们就可以查看ss在系统中的启动状态了。我们输入以下命令查看SS在服务器中的启动状态</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span>查看系统中ss服务的启动状态</span><br><span class=\"line\">systemctl status shadowsocks -l</span><br></pre></td></tr></table></figure>\n<p>​    可以看到ss服务已经在服务器中启动</p>\n<div class=\"article-img\"><p><img src=\"/images/shadowsocks/1548401963119.png\" alt=\"1548401963119\"></p></div>\n<p>​    启动以后我们打开本机的cmd，通过telnet 139.180.134.227 8989测试该服务器端口是否开放，语法格式是telnet {ip} {服务端口}。如下图所示。可知服务器的8989并没有打开    </p>\n<div class=\"article-img\"><p><img src=\"/images/shadowsocks/1548403019557.png\" alt=\"1548403019557\"></p></div>\n<p>​    如果你的cmd和我的一样没有telnet指令。只是应为windows的telnet客户端功能没有启用。我们点键盘的win键。打开控制面板，-&gt; ‘程序与功能’-&gt;打开或关闭Windows功能-&gt;勾选telnet客户端-&gt;确定以后即可在cmd中使用telnet命令。</p>\n<p>​    回到服务器中，我们知道ss服务已启动，该服务的端口访问不到。有经验的小伙伴一想就知道这是端口没有开放，需要修改一下防火墙。</p>\n<p>​    输入一下命令行，我们开放服务器的8989端口。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span>开放8989端口的</span><br><span class=\"line\">firewall-cmd --permanent --add-port=8989/tcp</span><br><span class=\"line\">firewall-cmd --permanent --add-port=8989/udp</span><br><span class=\"line\"><span class=\"meta\">#</span>重启防火墙</span><br><span class=\"line\">firewall-cmd --reload</span><br></pre></td></tr></table></figure>\n<p>​    我们再次使用windows的cmd Telnet 139.180.134.227 8989 </p>\n<div class=\"article-img\"><p><img src=\"/images/shadowsocks/1548403203034.png\" alt=\"1548403203034\"></p></div>\n<p>​    回到我们的windows系统，现在我们解压打开附带文件中的shadowsocks客户端，输入我们配置的ss服务器时输入的地址，端口和密码。选着对应的加密方式。</p>\n<div class=\"article-img\"><p><img src=\"/images/shadowsocks/1548403235141.png\" alt=\"1548403235141\"></p></div>\n<p>​    好了，点击确认，打开我们的chrome或者google浏览器。输入一个国外的网站如<a href=\"https://www.youtube.com/。即可畅享科学上网冲浪。\" target=\"_blank\" rel=\"noopener\">https://www.youtube.com/。即可畅享科学上网冲浪。</a></p>\n","next":{"title":"angularJS的$compile","slug":"firtBlog"},"link":"https://rexken.github.io/post/shadowsocks/","toc":[{"title":"搭建SS服务器","id":"搭建SS服务器","index":"1","children":[{"title":"准备工作","id":"准备工作","index":"1.1"},{"title":"开始搭建","id":"开始搭建","index":"1.2"}]}]}